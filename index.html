<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!--
Design by Free CSS Templates
http://www.freecsstemplates.org
Released for free under a Creative Commons Attribution 2.5 License

Name       : Brown Stone  
Description: A two-column, fixed-width design with dark color scheme.
Version    : 1.0
Released   : 20100928

-->
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta name="keywords" content="" />
<meta name="description" content="" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>博客</title>
<link href="https://blog.pygod.vip/theme/css/style.css" rel="stylesheet" type="text/css" media="screen" />
<link href="https://blog.pygod.vip/" type="application/atom+xml" rel="alternate" title="博客 ATOM Feed" />
</head>
<body>
<div id="wrapper">
	<div id="page">
		<div id="page-bgtop">
			<div id="page-bgbtm">
 
        
				<div id="content">
					<div class="post">
						<h2 class="title"><a href="https://blog.pygod.vip/gai-shu.html">概述</a></h2>
						<p class="meta"><span class="date">Le  </span><span class="posted">Par <a href="#">hanf</a></span><span>&nbsp; | Catégorie : <a href="https://blog.pygod.vip/category/web3py.html">web3py</a></span></p>
					<p class="meta">Tags : <span><a href="https://blog.pygod.vip/tag/zhi-neng-he-yue.html">智能合约</a> / </span>
<span><a href="https://blog.pygod.vip/tag/web3.html">web3</a> / </span>
<span><a href="https://blog.pygod.vip/tag/ethereum.html">ethereum</a> / </span>
</p>
						<div style="clear: both;">&nbsp;</div>
						<div class="entry">
						 <p>该文章目的是让您了解Web3.py的所有功能，并作为一个快速的参考指南。</p>
<h1>配置</h1>
<p>通过pip安装完web3后，除了默认值之外，你还需要指定provider和一些中间件。  </p>
<h2>providers</h2>
<p>providers是web3连接区块链的方式。web3库有以下内置几个providers：<br>
- web3.IPCProvider：用于连接基于<strong>ipc套接字</strong>的 JSON-RPC 服务器
- web3.HTTPProvider：用于连接基于<strong>http和https</strong>的 JSON-RPC 服务器
- web3.WebsockerProvider：用于连接基于<strong>ws和wss的websocker</strong>的 JSON-RPC服务器</p>
<div class="highlight"><pre><span></span><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">web3</span> <span class="kn">import</span> <span class="n">Web3</span>

<span class="c1"># IPCProvider:</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">w3</span> <span class="o">=</span> <span class="n">Web3</span><span class="p">(</span><span class="n">Web3</span><span class="o">.</span><span class="n">IPCProvider</span><span class="p">(</span><span class="s1">&#39;./path/to/geth.ipc&#39;</span><span class="p">))</span>

<span class="c1"># HTTPProvider:</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">w3</span> <span class="o">=</span> <span class="n">Web3</span><span class="p">(</span><span class="n">Web3</span><span class="o">.</span><span class="n">HTTPProvider</span><span class="p">(</span><span class="s1">&#39;http://127.0.0.1:8545&#39;</span><span class="p">))</span>

<span class="c1"># WebsocketProvider:</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">w3</span> <span class="o">=</span> <span class="n">Web3</span><span class="p">(</span><span class="n">Web3</span><span class="o">.</span><span class="n">WebsocketProvider</span><span class="p">(</span><span class="s1">&#39;ws://127.0.0.1:8546&#39;</span><span class="p">))</span>

<span class="o">&gt;&gt;&gt;</span> <span class="n">w3</span><span class="o">.</span><span class="n">isConnected</span><span class="p">()</span>
<span class="bp">True</span>
</code></pre></div>

<p>更多信息(如连接到远程节点；provider自动检测；使用测试provider)参考(https://web3py.readthedocs.io/en/stable/providers.html#providers)  </p>
<h2>中间件</h2>
<p>可以通过中间件配置web3实例。<br>
就像剥洋葱一样，每一层中间件都可能影响<strong>入参request</strong> 和 <strong>出参</strong>。<br>
<a href="https://web3py.readthedocs.io/en/stable/middleware.html#modifying-middleware">该文档</a>包含了一些可视化的东西。  </p>
<p>有些中间件是<a href="https://web3py.readthedocs.io/en/stable/middleware.html#default-middleware">默认加载的</a>。
你可以 <strong>添加/注入/替换</strong> 任何一个中间件，也可以 <strong>禁用/删除/清除</strong> 任何一个中间件。</p>
<h1>你的keys</h1>
<p>想要进行交易，那么 <strong>私钥</strong> 必不可少。你 <strong>密钥的安全方式</strong> 将决定你在web3中如何 <strong>创建交易</strong> 和 <strong>发送交易</strong>。  </p>
<p>像<a href="https://geth.ethereum.org/">Geth</a>这种的本地节点，会帮你管理你的密钥。你可以通过使用 <strong>web3.eth.account</strong> 来引用你的密钥。  </p>
<p>像<a href="https://infura.io/">Infura</a>这样的托管(远程)节点，不知道你的密钥是多少。这种情况下，你需要使用你<strong>本地的私钥</strong> 来 <strong>签署事务</strong>。  </p>
<p>关于密钥之间的区别，可参考<a href="https://web3py.readthedocs.io/en/stable/web3.eth.account.html#eth-account">这里</a>  </p>
<h1>基础api</h1>
<p><a href="https://web3py.readthedocs.io/en/stable/web3.main.html#web3-base">Web3</a>类包含很多实用的函数。  </p>
<h2>编码解码函数</h2>
<ul>
<li>Web3.is_encodable()</li>
<li>Web3.toBytes()</li>
<li>Web3.toHex()</li>
<li>Web3.toInt()</li>
<li>Web3.toJSON()</li>
<li>Web3.toText()</li>
</ul>
<h2>地址函数</h2>
<ul>
<li>Web3.isAddress()</li>
<li>Web3.isChecksumAddress()</li>
<li>Web3.toChecksumAddress()</li>
</ul>
<h2>货币换算</h2>
<ul>
<li>Web3.fromWei()</li>
<li>Web3.toWei()</li>
</ul>
<h2>加密哈希</h2>
<ul>
<li>Web3.keccak()</li>
<li>Web3.solidityKeccak()</li>
</ul>
<h1>eth的api</h1>
<p>与以太坊交互的最常用的api可以在web3.eth命名空间下找到。<a href="https://web3py.readthedocs.io/en/stable/examples.html#examples">完整示例参考</a>  </p>
<h2>获取数据</h2>
<p>查看帐户余额(getBalance)、事务(getTransaction)和块数据(getBlock)是Web3.py中最常见的起点。<br>
- web3.eth.getBalance()
- web3.eth.getBlock()
- web3.eth.getBlockTransactionCount()
- web3.eth.getCode()
- web3.eth.getProof()
- web3.eth.getStorageAt()
- web3.eth.getTransaction()
- web3.eth.getTransactionByBlock()
- web3.eth.getTransactionCount()
- web3.eth.getUncleByBlock()
- web3.eth.getUncleCount()</p>
<h2>执行交易</h2>
<p>最常用的有 <strong>sendTransaction</strong> 或者 <strong>signTransaction 和 sendRawTransaction 的组合</strong>。<br>
如果与智能合约进行交互，则存在专用的API。<a href="https://web3py.readthedocs.io/en/stable/overview.html#overview-contracts">参考</a><br>
- web3.eth.sendTransaction()
- web3.eth.signTransaction()
- web3.eth.sendRawTransaction()
- web3.eth.replaceTransaction()
- web3.eth.modifyTransaction()
- web3.eth.waitForTransactionReceipt()
- web3.eth.getTransactionReceipt()
- web3.eth.sign()
- web3.eth.signTypedData()
- web3.eth.estimateGas()
- web3.eth.generateGasPrice()
- web3.eth.setGasPriceStrategy()</p>
<h2>合约</h2>
<p>合约最常用是：在已部署的合约上<strong>部署</strong>和<strong>执行功能</strong>。<br>
部署合约需要先编译，这个编译不一定要在本地完成，可以使用:
- 本地solidity编译器，如：本地安装solc编译器（apt install solc）
- 在线编辑器<a href="http://remix.ethereum.org/">Remix</a>
- 开发框架，如<a href="https://eth-brownie.readthedocs.io/en/stable/">Brownie</a>  </p>
<p>一旦合约对象被实例化了，可调用构造函数contructor的transact方法来发布一个合约实例，如下：  </p>
<div class="highlight"><pre><span></span><code><span class="o">#</span> <span class="err">声明合约对象</span>
<span class="n">ExampleContract</span> <span class="o">=</span> <span class="n">w3</span><span class="p">.</span><span class="n">eth</span><span class="p">.</span><span class="n">contract</span><span class="p">(</span><span class="n">abi</span><span class="o">=</span><span class="n">abi</span><span class="p">,</span> <span class="n">bytecode</span><span class="o">=</span><span class="n">bytecode</span><span class="p">)</span>

<span class="o">#</span> <span class="err">发布合约，得到交易</span><span class="n">hash</span>
<span class="n">tx_hash</span> <span class="o">=</span> <span class="n">ExampleContract</span><span class="p">.</span><span class="k">constructor</span><span class="p">().</span><span class="n">transact</span><span class="p">()</span>

<span class="o">#</span> <span class="err">发起等待交易，得到等待交易的对象</span>
<span class="n">tx_receipt</span> <span class="o">=</span> <span class="n">w3</span><span class="p">.</span><span class="n">eth</span><span class="p">.</span><span class="n">waitForTransactionReceipt</span><span class="p">(</span><span class="n">tx_hash</span><span class="p">)</span>

<span class="o">#</span> <span class="err">等待交易的地址</span>
<span class="n">tx_receipt</span><span class="p">.</span><span class="n">contractAddress</span>
</code></pre></div>

<p>一旦加载到合约对象中，已发布的合约对象的方法在w3.eth命名空间中可用，具体表现如下：</p>
<div class="highlight"><pre><span></span><code><span class="o">#</span> <span class="err">根据待交易的地址和</span><span class="n">abi获取合约对象</span>
<span class="n">deployed_contract</span> <span class="o">=</span> <span class="n">w3</span><span class="p">.</span><span class="n">eth</span><span class="p">.</span><span class="n">contract</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="n">tx_receipt</span><span class="p">.</span><span class="n">contractAddress</span><span class="p">,</span> <span class="n">abi</span><span class="o">=</span><span class="n">abi</span><span class="p">)</span>

<span class="n">deployed_contract</span><span class="p">.</span><span class="n">functions</span><span class="p">.</span><span class="n">myFunction</span><span class="p">(</span><span class="mi">42</span><span class="p">).</span><span class="n">transact</span><span class="p">()</span>
</code></pre></div>

<p>如果你想从合约中获取数据（或者在本地查看事务结果，而不是在网络上执行），你可以使用：<br>
- <a href="https://web3py.readthedocs.io/en/stable/contracts.html#web3.contract.ContractFunction.call">ContractFunction.call</a>方法
- <a href="https://web3py.readthedocs.io/en/stable/contracts.html#web3.contract.ContractCaller">ContractCaller</a>方法</p>
<div class="highlight"><pre><span></span><code><span class="err">deployed_contract.functions.getMyValue().call()</span>
<span class="err"># 或者</span>
<span class="err">deployed_contract.caller().getMyValue()</span>
</code></pre></div>

<p>想要了解更多，参考 https://web3py.readthedocs.io/en/stable/contracts.html#contracts</p>
<ul>
<li>web3.eth.contract()</li>
<li>Contract.address</li>
<li>Contract.abi</li>
<li>Contract.bytecode</li>
<li>Contract.bytecode_runtime</li>
<li>Contract.functions</li>
<li>Contract.events</li>
<li>Contract.fallback</li>
<li>Contract.constructor()</li>
<li>Contract.encodeABI()</li>
<li>web3.contract.ContractFunction</li>
<li>web3.contract.ContractEvents</li>
</ul>
<h2>日志和过滤器</h2>
<p>当 <strong>新块被挖出</strong> 或者 <strong>合约发出特定的事件</strong> 时，你想做出一些反应，可以用web3过滤器。  </p>
<div class="highlight"><pre><span></span><code><span class="o">#</span> <span class="err">刷选新块</span>
<span class="n">new_filter</span> <span class="o">=</span> <span class="n">web3</span><span class="p">.</span><span class="n">eth</span><span class="p">.</span><span class="n">filter</span><span class="p">(</span><span class="s1">&#39;latest&#39;</span><span class="p">)</span>

<span class="o">#</span> <span class="err">合同事件</span><span class="p">(</span><span class="err">名为“</span><span class="n">MyEvent</span><span class="err">”</span><span class="p">)</span><span class="err">过滤器</span>
<span class="n">new_filter</span> <span class="o">=</span> <span class="n">deployed_contract</span><span class="p">.</span><span class="n">events</span><span class="p">.</span><span class="n">MyEvent</span><span class="p">.</span><span class="n">createFilter</span><span class="p">(</span><span class="n">fromBlock</span><span class="o">=</span><span class="s1">&#39;latest&#39;</span><span class="p">)</span>

<span class="o">#</span> <span class="err">检索结果过滤</span>
<span class="n">new_filter</span><span class="p">.</span><span class="n">get_all_entries</span><span class="p">()</span>
<span class="n">new_filter</span><span class="p">.</span><span class="n">get_new_entries</span><span class="p">()</span>
</code></pre></div>

<p>想要了解更多，参考 https://web3py.readthedocs.io/en/stable/filters.html#filtering</p>
<ul>
<li>web3.eth.filter()</li>
<li>web3.eth.getFilterChanges()</li>
<li>web3.eth.getFilterLogs()</li>
<li>web3.eth.uninstallFilter()</li>
<li>web3.eth.getLogs()</li>
<li>Contract.events.your_event_name.createFilter()</li>
<li>Contract.events.your_event_name.build_filter()</li>
<li>Filter.get_new_entries()</li>
<li>Filter.get_all_entries()</li>
<li>Filter.format_entry()</li>
<li>Filter.is_valid_entry()</li>
</ul>
<h1>Net API</h1>
<p>一些基本的网络属性，可用web3.net查看
- web3.net.listening
- web3.net.peer_count
- web3.net.version</p>
<h1>ethPM</h1>
<ul>
<li>打包合同，以重复使用</li>
<li>使用另一个受信任的注册表中的合同<br>
想要了解更多，参考：https://web3py.readthedocs.io/en/stable/ethpm.html#ethpm  </li>
</ul>
<h1>ENS</h1>
<p><a href="https://ens.domains/">Ethereum Name Service (ENS)</a> 提供了人类可读地址的结构。如：你可以把资金发送到ethereumfoundation.eth。web3支持ens，详细参考：https://web3py.readthedocs.io/en/stable/ens_overview.html#ens-overview  </p>	
						</div>
					</div>
	
			                <div class="post">
			                        <h2 class="title">Autres articles</h2>
			                </div>
        
 
			                <div class="post summary">
						<h2 class="title"><a href="https://blog.pygod.vip/kuai-su-kai-shi.html">快速开始</a></h2>
						<p class="meta"><span class="date">Le 2020-12-03 09:23:00</span><span class="posted">Par <a href="#">hanf</a></span></p>
						<div style="clear: both;">&nbsp;</div>
						<div class="entry">
						 <p>只是将web3py的<a href="https://web3py.readthedocs.io/en/stable/quickstart.html">官方文档</a> 做了一些翻译</p>	
						 <a class="readmore" href="https://blog.pygod.vip/kuai-su-kai-shi.html">Lire la suite …</a>
						</div>
					</div>
        
 
			                <div class="post summary">
						<h2 class="title"><a href="https://blog.pygod.vip/ethereum.html">ethereum</a></h2>
						<p class="meta"><span class="date">Le 2020-11-28 10:30:00</span><span class="posted">Par <a href="#">hanf</a></span></p>
						<div style="clear: both;">&nbsp;</div>
						<div class="entry">
						 <p>以太坊</p>	
						 <a class="readmore" href="https://blog.pygod.vip/ethereum.html">Lire la suite …</a>
						</div>
					</div>
        
 
			                <div class="post summary">
						<h2 class="title"><a href="https://blog.pygod.vip/flask-contract.html">flask contract</a></h2>
						<p class="meta"><span class="date">Le 2020-11-23 16:15:00</span><span class="posted">Par <a href="#">hanf</a></span></p>
						<div style="clear: both;">&nbsp;</div>
						<div class="entry">
						 <p>利用python的flask框架开发智能合约</p>	
						 <a class="readmore" href="https://blog.pygod.vip/flask-contract.html">Lire la suite …</a>
						</div>
					</div>
        
 
			                <div class="post summary">
						<h2 class="title"><a href="https://blog.pygod.vip/bian-yi-bu-shu-zhi-neng-he-yue.html">编译/部署智能合约</a></h2>
						<p class="meta"><span class="date">Le 2020-11-21 11:10:00</span><span class="posted">Par <a href="#">hanf</a></span></p>
						<div style="clear: both;">&nbsp;</div>
						<div class="entry">
						 <p>编译部署智能合约，想看原汁原味的英文文档可移步至(https://kauri.io/#communities/Getting%20started%20with%20dapp%20development/understanding-smart-contract-compilation-and-depl)，本文做了一些简单翻译，且只针对ubuntu系统</p>	
						 <a class="readmore" href="https://blog.pygod.vip/bian-yi-bu-shu-zhi-neng-he-yue.html">Lire la suite …</a>
						</div>
					</div>
        
 
			                <div class="post summary">
						<h2 class="title"><a href="https://blog.pygod.vip/markdownyu-fa.html">markdown语法</a></h2>
						<p class="meta"><span class="date">Le 2020-11-21 11:10:00</span><span class="posted">Par <a href="#">hanf</a></span></p>
						<div style="clear: both;">&nbsp;</div>
						<div class="entry">
						 <p>markdown语法介绍</p>	
						 <a class="readmore" href="https://blog.pygod.vip/markdownyu-fa.html">Lire la suite …</a>
						</div>
					</div>
        
 
			                <div class="post summary">
						<h2 class="title"><a href="https://blog.pygod.vip/pelicanbian-xie-bo-ke-guan-jian-ci.html">pelican编写博客关键词</a></h2>
						<p class="meta"><span class="date">Le 2020-11-21 11:10:00</span><span class="posted">Par <a href="#">hanf</a></span></p>
						<div style="clear: both;">&nbsp;</div>
						<div class="entry">
						 <p>pelican编写博客，md文件的关键词</p>	
						 <a class="readmore" href="https://blog.pygod.vip/pelicanbian-xie-bo-ke-guan-jian-ci.html">Lire la suite …</a>
						</div>
					</div>
        
 
			                <div class="post summary">
						<h2 class="title"><a href="https://blog.pygod.vip/pelicanpei-zhi.html">pelican配置</a></h2>
						<p class="meta"><span class="date">Le 2020-11-21 11:10:00</span><span class="posted">Par <a href="#">hanf</a></span></p>
						<div style="clear: both;">&nbsp;</div>
						<div class="entry">
						 <p>pelican配置文件（pelicanconf.py）的相关设置</p>	
						 <a class="readmore" href="https://blog.pygod.vip/pelicanpei-zhi.html">Lire la suite …</a>
						</div>
					</div>
        
 
			                <div class="post summary">
						<h2 class="title"><a href="https://blog.pygod.vip/docker-ming-ling.html">Docker 命令</a></h2>
						<p class="meta"><span class="date">Le 2020-11-20 10:20:00</span><span class="posted">Par <a href="#">hanf</a></span></p>
						<div style="clear: both;">&nbsp;</div>
						<div class="entry">
						 <p>docker命令介绍</p>	
						 <a class="readmore" href="https://blog.pygod.vip/docker-ming-ling.html">Lire la suite …</a>
						</div>
					</div>
					<div style="clear: both;">&nbsp;</div>
				</div>
				<div id="sidebar">
					<div id="logo">
						<h1><a href="https://blog.pygod.vip">博客</a></h1>
					</div>
					<div id="menu">
						<ul>
							<li class="current_page_item"><a href="https://blog.pygod.vip">Home</a></li>
							<li ><a href="https://blog.pygod.vip/archives.html">Archives</a></li>
						</ul>
					</div>
					<ul>
						<li>
							<h2>Catégories</h2>
							<ul>
								 <li ><a href="https://blog.pygod.vip/category/docker.html">Docker</a></li>
								 <li ><a href="https://blog.pygod.vip/category/pelican.html">Pelican</a></li>
								 <li ><a href="https://blog.pygod.vip/category/qu-kuai-lian.html">区块链</a></li>
								 <li ><a href="https://blog.pygod.vip/category/web3py.html">web3py</a></li>
								 <li ><a href="https://blog.pygod.vip/category/yu-fa.html">语法</a></li>
							</ul>
						</li>
						<li>
							<h2>Blogroll</h2>
							<ul>
                                                            <li><a href="https://getpelican.com/">Pelican</a></li>
                                                            <li><a href="https://www.python.org/">Python.org</a></li>
                                                            <li><a href="https://palletsprojects.com/p/jinja/">Jinja2</a></li>
                                                            <li><a href="#">You can modify those links in your config file</a></li>
							</ul>
						</li>
                                                <li>
                                                        <h2>Social</h2>
                                                        <ul>
                                                            <li><a href="https://blog.pygod.vip/" rel="alternate">Flux Atom</a></li>
                                                            <li><a href="#">You can add links in your config file</a></li>
                                                            <li><a href="#">Another social link</a></li>
                                                        </ul>
                                                </li><!-- /.social -->
						<li>
						        <h2>Tags</h2>
						        <ul>
                                                                <li><a href="https://blog.pygod.vip/tag/zhi-neng-he-yue.html">智能合约</a></li>
                                                                <li><a href="https://blog.pygod.vip/tag/web3.html">web3</a></li>
                                                                <li><a href="https://blog.pygod.vip/tag/ethereum.html">ethereum</a></li>
                                                                <li><a href="https://blog.pygod.vip/tag/qu-kuai-lian.html">区块链</a></li>
                                                                <li><a href="https://blog.pygod.vip/tag/solidity.html">solidity</a></li>
                                                                <li><a href="https://blog.pygod.vip/tag/markdown.html">markdown</a></li>
                                                                <li><a href="https://blog.pygod.vip/tag/pelican.html">pelican</a></li>
                                                                <li><a href="https://blog.pygod.vip/tag/docker.html">docker</a></li>
						        </ul>
						</li>
						
						
					</ul>
				</div>
				<!-- end #sidebar -->
				<div style="clear: both;">&nbsp;</div>
			</div>
		</div>
	</div>
	<!-- end #page -->

<div id="footer">
	<p>Copyright (c) 2008 Sitename.com. All rights reserved. Design by <a href="http://www.freecsstemplates.org/">CSS Templates</a>.</p>
	<p>Proudly powered by <a href="http://alexis.notmyidea.org/pelican/">pelican</a>, which takes great advantages of <a href="http://python.org">python</a>.
</p>
</div>
<!-- end #footer -->
</body>
</html>